(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0bdf7998","chunk-425d8fd8"],{1148:function(e,t,r){"use strict";var a=r("5926"),n=r("577e"),s=r("1d80"),i=RangeError;e.exports=function(e){var t=n(s(this)),r="",o=a(e);if(o<0||o===1/0)throw new i("Wrong number of repetitions");for(;o>0;(o>>>=1)&&(t+=t))1&o&&(r+=t);return r}},"4fad":function(e,t,r){"use strict";var a=r("23e7"),n=r("6f53").entries;a({target:"Object",stat:!0},{entries:function(e){return n(e)}})},5174:function(e,t,r){"use strict";r.r(t);var a=r("c7eb"),n=r("1da1"),s=r("3835"),i=(r("99af"),r("a15b"),r("d81d"),r("b0c0"),r("e9f5"),r("7d54"),r("ab43"),r("4fad"),r("d3b7"),r("159b"),r("7f29")),o=r("ebc5"),u=r.n(o),c=r("8d5e"),l=r.n(c),d="http://10.23.56.29:8090/iserver/services/data-gis-2/rest/data",p="address_disaster@DataSourceDisasterGIS",f=200;t["default"]={data:function(){return{map:null,pointLayer:null,linesLayer:null,dialogVisible:!1,riskdialogVisible1:!1,riskdialogVisible2:!1,isBianPo:!1,resultBoundsLayer:null,form:{city:""},districtDisasterModel:{southern:0,central:0,northern:0},disasterTypeModel:{bt:0,tx:0,hp:0,nsl:0,sh:0},rectificationProgressModel:{total:0,already:0,deal:0}}},computed:{disasterTypeCount:function(){var e=this.disasterTypeModel,t=e.bt,r=e.tx,a=e.hp,n=e.nsl,s=e.sh,i=t+r+a+n+s;return i},disasterTypeOption:function(){var e=this.disasterTypeModel,t=e.bt,r=e.tx,a=e.hp,n=e.nsl,s=e.sh,o=this.disasterTypeCount;return[{name:"崩塌",value:t,percent:Object(i["a"])(t,o),color:"#A780FF"},{name:"塌陷",value:r,percent:Object(i["a"])(r,o),color:"#3C9EFF"},{name:"滑坡",value:a,percent:Object(i["a"])(a,o),color:"#47E2DF"},{name:"泥石流",value:n,percent:Object(i["a"])(n,o),color:"#3EFF99"},{name:"水毁",value:s,percent:Object(i["a"])(s,o),color:"#FFD84A"}]}},mounted:function(){var e=this;this.$nextTick((function(){e.initMap(),e.refreshDataView()}))},methods:{refreshMap:function(){var e=this.map;e.getZoom()},clearLayersFeatures:function(){this.clearBoundsFeatures(),this.clearPointLayerFeatures(),this.clearLinesLayerFeatures()},initMap:function(){var e=this,t=L.map("map",{center:[30.76,103.96],zoom:5,zoomSnap:.25,crs:L.supermap.CRS.TianDiTu_WGS84,zoomControl:!1});this.linesLayer=(new L.LayerGroup).addTo(t),this.pointLayer=(new L.LayerGroup).addTo(t);new L.supermap.TiledMapLayer("http://10.23.17.229:8090/iserver/services/map-gis-disaster--2--4/rest/maps/DataSourceGIS2-sichuan",{transparent:!0,noWrap:!0}).addTo(t),L.icon.pulse({iconSize:[32,32],color:"#f00"});var r=L.icon({iconUrl:u.a,iconSize:[70,70]}),a=L.marker([29.64,104.59],{icon:r}).addTo(t);a.on("click",(function(){e.riskdialogVisible1=!0}));var n=L.icon({iconUrl:l.a,iconSize:[70,70]}),s=L.marker([31.561596,103.524355],{icon:n}).addTo(t);s.on("click",(function(){e.riskdialogVisible2=!0})),this.map=t},polygonToGeoJSON:function(e){var t=e.getVertices(),r=t.map((function(e){return[e.x,e.y]})),a={type:"Feature",geometry:{type:"Polygon",coordinates:[r]},properties:{}};return a},boundsToGeometry:function(e){var t=e.getSouthWest(),r=e.getNorthEast(),a=[new SuperMap.Geometry.Point(t.lng,t.lat),new SuperMap.Geometry.Point(r.lng,t.lat),new SuperMap.Geometry.Point(r.lng,r.lat),new SuperMap.Geometry.Point(t.lng,r.lat),new SuperMap.Geometry.Point(t.lng,t.lat)],n=new SuperMap.Geometry.LinearRing(a);return new SuperMap.Geometry.Polygon([n])},clearBoundsFeatures:function(){this.map;if(this.resultBoundsLayer){var e=this.resultBoundsLayer;e.clearLayers()}},clearPointLayerFeatures:function(){this.map;if(this.pointLayer){var e=this.pointLayer;e.clearLayers()}},clearLinesLayerFeatures:function(){this.map;if(this.linesLayer){var e=this.linesLayer;e.clearLayers()}},loadLines:function(){this.clearLinesLayerFeatures();var e=this.map,t=this,r=e.getBounds(),a=new SuperMap.Bounds(r.getWest(),r.getSouth(),r.getEast(),r.getNorth()),n=["#0078FF","#FF5733","#2ECC71"],i=["DataSourceGIS2:gz_L21_52_G","DataSourceGIS2:gz_L21_52_S"],o=function(e,r,a,n,i){var u=a*f,c=u+f,l=new SuperMap.GetFeaturesByBoundsParameters({datasetNames:[e],bounds:r,returnContent:!0,fromIndex:u,toIndex:c}),p=new SuperMap.GetFeaturesByBoundsService(d);p.processAsync(l,(function(u){if(u.result&&u.result.features){var c=L.geoJSON(u.result.features,{style:{color:i,weight:5},onEachFeature:function(e,t){t.on("click",(function(){console.log(e,"1-----1");var r=e.properties,a=r.name||r.名称||"未命名线路",n=Object.entries(r).map((function(e){var t=Object(s["a"])(e,2),r=t[0],a=t[1];return"<b>".concat(r,":</b> ").concat(a)})).join("<br>");t.bindPopup("<h4>".concat(a,"</h4>").concat(n)).openPopup()}))}});t.linesLayer.addLayer(c),u.result.featureCount===f&&o(e,r,a+1,n,i)}}))};i.forEach((function(e,t){o(e,a,0,[],n[t%3])}))},loadLinesByBounds:function(e){this.clearBoundsFeatures();var t=this,r=this.map;t.loading=!0;var a=this.polygonToGeoJSON(this.boundsToGeometry(r.getBounds())),n=L.supermap.Util.transform(a,L.CRS.EPSG4326,L.CRS.EPSG3857),s=new L.supermap.QueryByGeometryParameters({queryParams:{name:"China_Province_pl@China"},featureCount:1e6,geometry:n,spatialQueryMode:SuperMap.SpatialQueryMode.INTERSECT}),i=new L.supermap.QueryService("http://10.23.17.229:8090/iserver/services/map-china400/rest/maps/China");i.queryByGeometry(s,(function(e){t.loading=!1;var a=L.supermap.Util.transform(e.result.recordsets[0].features,L.CRS.EPSG3857,L.CRS.EPSG4326);t.resultBoundsLayer=L.geoJSON(a).addTo(r)}))},renderVisiblePoints:function(){var e=this,t=this.map,r=this.pointLayer,a=t.getBounds(),n=a.getSouthWest(),i=a.getNorthEast(),o=L.icon.pulse({iconSize:[12,12],color:"#f00"});this.clearPointLayerFeatures();var u=new SuperMap.GetFeaturesByBoundsParameters({queryParams:{name:"address_disaster@DataSourceDisasterGIS",attributeFilter:"disaster_grade = '一级'"},datasetNames:["DataSourceDisasterGIS:address_disaster"],bounds:new SuperMap.Bounds(n.lng,n.lat,i.lng,i.lat),fromIndex:0,toIndex:50,spatialQueryMode:SuperMap.SpatialQueryMode.CONTAIN});L.supermap.featureService(d).getFeaturesByBounds(u,(function(t){var a=t.result.features.features;a.forEach((function(t){var a=Object(s["a"])(t.geometry.coordinates,2),n=a[0],i=a[1],u=L.marker([i,n],{icon:o}).addTo(r);u.on("click",(function(){console.log(t,"1----1")})),e.pointLayer.addLayer(layer)}))}))},refreshDataView:function(){this.getDistrictDisaster(),this.getDisasterType(),this.getRectificationProgress()},getDistrictDisaster:function(){return Object(n["a"])(Object(a["a"])().mark((function e(){return Object(a["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},getDisasterType:function(){var e=this;return Object(n["a"])(Object(a["a"])().mark((function t(){var r,n,s,i,o,u,c,l,f,y,h;return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=function(e,t){var r=new L.supermap.GetFeaturesBySQLParameters({queryParameter:{name:e,attributeFilter:t},datasetNames:["DataSourceDisasterGIS:address_disaster"]});return r},n="ds_type = '崩塌'",t.next=4,e.queryDisasterDataset(d,r(p,n));case 4:return s=t.sent,e.disasterTypeModel.bt=s.result.totalCount||0,i="ds_type = '塌陷'",t.next=9,e.queryDisasterDataset(d,r(p,i));case 9:return o=t.sent,e.disasterTypeModel.tx=o.result.totalCount||0,u="ds_type = '滑坡'",t.next=14,e.queryDisasterDataset(d,r(p,u));case 14:return c=t.sent,e.disasterTypeModel.hp=c.result.totalCount||0,l="ds_type = '泥石流'",t.next=19,e.queryDisasterDataset(d,r(p,l));case 19:return f=t.sent,e.disasterTypeModel.nsl=f.result.totalCount||0,y="ds_type = '水毁'",t.next=24,e.queryDisasterDataset(d,r(p,y));case 24:h=t.sent,e.disasterTypeModel.sh=h.result.totalCount||0;case 26:case"end":return t.stop()}}),t)})))()},getRectificationProgress:function(){var e=this;return Object(n["a"])(Object(a["a"])().mark((function t(){var r,n,s,i,o,u,c;return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=function(e,t){var r=new L.supermap.GetFeaturesBySQLParameters({queryParameter:{name:e,attributeFilter:t},datasetNames:["DataSourceDisasterGIS:address_disaster"]});return r},n="treatment_situation = '已处治修复' or treatment_situation = '未处治修复' or treatment_situation = '正在处治修复'",t.next=4,e.queryDisasterDataset(d,r(p,n));case 4:return s=t.sent,e.rectificationProgressModel.total=s.result.totalCount||0,i="treatment_situation = '已处治修复'",t.next=9,e.queryDisasterDataset(d,r(p,i));case 9:return o=t.sent,e.rectificationProgressModel.already=o.result.totalCount||0,u="treatment_situation = '正在处治修复' or treatment_situation = '未处治修复'",t.next=14,e.queryDisasterDataset(d,r(p,u));case 14:c=t.sent,e.rectificationProgressModel.deal=c.result.totalCount||0;case 16:case"end":return t.stop()}}),t)})))()},queryDisasterDataset:function(e,t){return new Promise((function(r,a){new L.supermap.FeatureService(e).getFeaturesBySQL(t).then((function(e){r(e)})).catch((function(e){a(e)}))}))}}}},"6f53":function(e,t,r){"use strict";var a=r("83ab"),n=r("d039"),s=r("e330"),i=r("e163"),o=r("df75"),u=r("fc6a"),c=r("d1e7").f,l=s(c),d=s([].push),p=a&&n((function(){var e=Object.create(null);return e[2]=2,!l(e,2)})),f=function(e){return function(t){var r,n=u(t),s=o(n),c=p&&null===i(n),f=s.length,y=0,h=[];while(f>y)r=s[y++],a&&!(c?r in n:l(n,r))||d(h,e?[r,n[r]]:n[r]);return h}};e.exports={entries:f(!0),values:f(!1)}},"7f29":function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"c",(function(){return n})),r.d(t,"b",(function(){return s}));r("a9e3"),r("b680"),r("d3b7"),r("25f0");function a(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=Number(e||0);if(!a)return"0.00";var n=a/t;return r&&(n*=100),n.toFixed(2)}function n(e){return(e/1e4).toFixed(2)}function s(e){return e>=1e4?n(e).toString()+"万":e.toString()+"个"}},"8d5e":function(e,t,r){e.exports=r.p+"static/img/icon-warning.99457d38.gif"},b680:function(e,t,r){"use strict";var a=r("23e7"),n=r("e330"),s=r("5926"),i=r("408a"),o=r("1148"),u=r("d039"),c=RangeError,l=String,d=Math.floor,p=n(o),f=n("".slice),y=n(1..toFixed),h=function(e,t,r){return 0===t?r:t%2===1?h(e,t-1,r*e):h(e*e,t/2,r)},m=function(e){var t=0,r=e;while(r>=4096)t+=12,r/=4096;while(r>=2)t+=1,r/=2;return t},g=function(e,t,r){var a=-1,n=r;while(++a<6)n+=t*e[a],e[a]=n%1e7,n=d(n/1e7)},v=function(e,t){var r=6,a=0;while(--r>=0)a+=e[r],e[r]=d(a/t),a=a%t*1e7},L=function(e){var t=6,r="";while(--t>=0)if(""!==r||0===t||0!==e[t]){var a=l(e[t]);r=""===r?a:r+p("0",7-a.length)+a}return r},S=u((function(){return"0.000"!==y(8e-5,3)||"1"!==y(.9,0)||"1.25"!==y(1.255,2)||"1000000000000000128"!==y(0xde0b6b3a7640080,0)}))||!u((function(){y({})}));a({target:"Number",proto:!0,forced:S},{toFixed:function(e){var t,r,a,n,o=i(this),u=s(e),d=[0,0,0,0,0,0],y="",S="0";if(u<0||u>20)throw new c("Incorrect fraction digits");if(o!==o)return"NaN";if(o<=-1e21||o>=1e21)return l(o);if(o<0&&(y="-",o=-o),o>1e-21)if(t=m(o*h(2,69,1))-69,r=t<0?o*h(2,-t,1):o/h(2,t,1),r*=4503599627370496,t=52-t,t>0){g(d,0,r),a=u;while(a>=7)g(d,1e7,0),a-=7;g(d,h(10,a,1),0),a=t-1;while(a>=23)v(d,1<<23),a-=23;v(d,1<<a),g(d,1,1),v(d,2),S=L(d)}else g(d,0,r),g(d,1<<-t,0),S=L(d)+p("0",u);return u>0?(n=S.length,S=y+(n<=u?"0."+p("0",u-n)+S:f(S,0,n-u)+"."+f(S,n-u))):S=y+S,S}})},ebc5:function(e,t,r){e.exports=r.p+"static/img/earthquake-warning.7783fa04.gif"}}]);