(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5de60491","chunk-2d2095e9"],{"4fad":function(e,t,a){"use strict";var r=a("23e7"),n=a("6f53").entries;r({target:"Object",stat:!0},{entries:function(e){return n(e)}})},"6f53":function(e,t,a){"use strict";var r=a("83ab"),n=a("d039"),s=a("e330"),o=a("e163"),i=a("df75"),u=a("fc6a"),c=a("d1e7").f,l=s(c),d=s([].push),p=r&&n((function(){var e=Object.create(null);return e[2]=2,!l(e,2)})),f=function(e){return function(t){var a,n=u(t),s=i(n),c=p&&null===o(n),f=s.length,y=0,h=[];while(f>y)a=s[y++],r&&!(c?a in n:l(n,a))||d(h,e?[a,n[a]]:n[a]);return h}};e.exports={entries:f(!0),values:f(!1)}},a983:function(e,t,a){"use strict";a.r(t);var r=a("3835"),n=a("5530"),s=(a("99af"),a("d81d"),a("14d9"),a("e9f5"),a("7d54"),a("ab43"),a("d3b7"),a("159b"),"http://10.23.17.229:8090/iserver/services/data-gis-disaster--3--2/rest/data"),o=200;t["default"]={data:function(){return{}},methods:{loadLineByPage:function(){var e=this.map,t=this,a=e.getBounds(),r=new SuperMap.Bounds(a.getWest(),a.getSouth(),a.getEast(),a.getNorth()),n=["#0078FF","#FF5733"],s=["11","12","13","14","15","21","22","23","31","32","33","34","35","36","37","41","42","43","44","45","46","50","51","52","53","54","61","62","63","64","65","66"],o=[];s.forEach((function(e){o.push("highway:L21_"+e+"_G"),o.push("highway-S:L21_"+e+"_S")})),this.dataSourceRequest(o,r,0,n).then((function(){console.log("所有道路数据请求处理完成"),t.renderVisiblePointsAll()})).catch((function(e){console.error("请求过程中出现错误:",e)}))},requestDatasourceBydatasetName:function(e,t,a,r,n){return new Promise((function(n,o){var i=new SuperMap.GetFeaturesByBoundsParameters({datasetNames:[e],bounds:t,returnContent:!0,fromIndex:a,toIndex:r}),u=new SuperMap.GetFeaturesByBoundsService(s);u.processAsync(i).then((function(e){n(e)})).catch((function(e){o(e)}))}))},dataSourceRequest:function(e,t,a,r){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=this;if(s>=e.length)return Promise.resolve();var u=e[s],c=a*o,l=c+o;return i.requestDatasourceBydatasetName(u,t,c,l,r).then((function(c){if(c.result&&c.result.features){var l=L.geoJSON(c.result.features,{style:{color:r[s%2],weight:5},onEachFeature:function(e,t){t.on("click",(function(e){var t=e.target.feature.properties||{},a="".concat(t.F03||"");i.dialogVisibleHightWayModel=Object(n["a"])({title:a},t),setTimeout((function(){i.dialogVisibleHightWay=!0}),300)}))}});if(i.linesLayer.addLayer(l),console.log(c.result,o,"1---1"),c.result.featureCount===o){var d=(a+1)*o,p=d+o;return i.requestDatasourceBydatasetName(u,t,d,p,r)}return i.dataSourceRequest(e,t,0,r,s+1).then((function(){}))}})).catch((function(e){return console.error("处理数组时出错:",e),Promise.reject(e)}))},renderVisiblePointsAll:function(){var e=this.map,t=this.pointLayer,a=e.getBounds(),i=a.getSouthWest(),u=a.getNorthEast(),c=this;this.clearPointLayerFeatures();var l=function(a){var d=a*o,p=d+o,f=new SuperMap.GetFeaturesByBoundsParameters({queryParams:{name:"all_User@allpoint-2"},datasetNames:["allpoint-2:all_User"],bounds:new SuperMap.Bounds(i.lng,i.lat,u.lng,u.lat),returnContent:!0,fromIndex:d,toIndex:p,spatialQueryMode:SuperMap.SpatialQueryMode.CONTAIN}),y=new SuperMap.GetFeaturesByBoundsService(s);y.processAsync(f,(function(s){var i=s.result.features.features;i.forEach((function(e){var a=Object(r["a"])(e.geometry.coordinates,2),s=a[0],o=a[1],i="";switch(e.properties.灾害等级){case"一级":i="red";break;case"二级":i="orange";break;case"三级":i="yellow";break;default:i="blue"}var u=L.circleMarker([o,s],{radius:8,color:i,fillOpacity:1,fillColor:i,zIndexOffset:9999}).addTo(t);u.on("click",(function(){var t=e.properties||{},a="".concat(t.END_STATION_NUMBER||"","灾害点-").concat(t.DS_TYPE);c.dialogVisibleModel=Object(n["a"])({title:a},t),setTimeout((function(){c.dialogVisible=!0}),300)}))})),e.addLayer(c.pointLayer),s.result.featureCount-1===o&&l(a+1)}))};l(0)}}}},fcc8:function(e,t,a){"use strict";a.r(t);var r=a("c7eb"),n=a("1da1"),s=a("3835"),o=(a("99af"),a("a15b"),a("d81d"),a("14d9"),a("b0c0"),a("e9f5"),a("ab43"),a("4fad"),a("d3b7"),a("a983")),i="http://10.23.17.229:8090/iserver/services/data-gis-disaster--3--2/rest/data",u="allpoint-2@all_User",c=200;t["default"]={mixins:[o["default"]],data:function(){return{map:null,pointLayer:null,linesLayer:null,dialogVisible:!1,dialogVisibleModel:{title:""},dialogVisibleHightWay:!1,dialogVisibleHightWayModel:{title:""},isBianPo:!1,resultBoundsLayer:null,updateTimer:null}},mounted:function(){var e=this;this.$nextTick((function(){e.initMap(),e.refreshDataView()}))},methods:{refreshMap:function(){var e=this,t=this.map,a=t.getZoom();a>=9?(clearTimeout(e.updateTimer),e.updateTimer=setTimeout((function(){e.makeRequests(a)}),400)):(e.clearLinesLayerFeatures(),e.clearPointLayerFeatures())},makeRequests:function(e){this.loadLinesG()},clearLayersFeatures:function(){this.clearBoundsFeatures(),this.clearPointLayerFeatures(),this.clearLinesLayerFeatures()},initMap:function(){var e=this,t=L.map("map",{center:[30.76,103.76],zoom:5,zoomSnap:.25,crs:L.supermap.CRS.TianDiTu_WGS84,zoomControl:!1});this.pointLayer=L.featureGroup().addTo(t).setZIndex(2),this.linesLayer=L.featureGroup().addTo(t).setZIndex(1),t.on("zoomstart",(function(){e.clearLayersFeatures()})),t.on("movestart",(function(){e.clearLayersFeatures()})),t.on("zoomend",(function(){e.refreshMap()})),t.on("dragend",(function(){e.refreshMap()})),t.on("moveend",(function(){e.refreshMap()}));var a="1d109683f4d84198e37a38c442d68311";new L.supermap.TiandituTileLayer({key:a}).addTo(t),new L.supermap.TiandituTileLayer({layerType:"img",key:a}).addTo(t),new L.supermap.TiandituTileLayer({layerType:"img",isLabel:!0,key:a}).addTo(t);new L.supermap.TiledMapLayer("http://10.23.17.229:8090/iserver/services/map-gis-disaster--2--4/rest/maps/DataSourceGIS2-sichuan",{transparent:!0,noWrap:!0}).addTo(t);this.map=t},polygonToGeoJSON:function(e){var t=e.getVertices(),a=t.map((function(e){return[e.x,e.y]})),r={type:"Feature",geometry:{type:"Polygon",coordinates:[a]},properties:{}};return r},boundsToGeometry:function(e){var t=e.getSouthWest(),a=e.getNorthEast(),r=[new SuperMap.Geometry.Point(t.lng,t.lat),new SuperMap.Geometry.Point(a.lng,t.lat),new SuperMap.Geometry.Point(a.lng,a.lat),new SuperMap.Geometry.Point(t.lng,a.lat),new SuperMap.Geometry.Point(t.lng,t.lat)],n=new SuperMap.Geometry.LinearRing(r);return new SuperMap.Geometry.Polygon([n])},clearBoundsFeatures:function(){var e=this.map;if(this.resultBoundsLayer){var t=this.resultBoundsLayer;e.removeLayer(t)}},clearPointLayerFeatures:function(){this.map;if(this.pointLayer){var e=this.pointLayer;e.clearLayers()}},clearLinesLayerFeatures:function(){this.map;if(this.linesLayer){var e=this.linesLayer;e.clearLayers()}},loadLinesG:function(){this.clearLinesLayerFeatures();var e=this.map,t=e.getBounds(),a=new SuperMap.Bounds(t.getWest(),t.getSouth(),t.getEast(),t.getNorth()),r=["#0078FF","#FF5733"],n=["11","12","13","14","15","21","22","23","31","32","33","34","35","36","37","41","42","43","44","45","46","50","51","52","53","54","61","62","63","64","65","66"],s=[];n.forEach((function(e){s.push("highway:L21_"+e+"_G"),s.push("highway-S:L21_"+e+"_S")})),this.loadLineByPage(s,a,0,r)},loadLines:function(){this.clearLinesLayerFeatures();var e=this.map,t=this,a=e.getBounds(),r=new SuperMap.Bounds(a.getWest(),a.getSouth(),a.getEast(),a.getNorth()),n=["#0078FF","#FF5733","#2ECC71"],o=["DataSourceGIS2:gz_L21_52_G","DataSourceGIS2:gz_L21_52_S","DataSourceGIS2:L21_34_G","DataSourceGIS2:L21_34_S","DataSourceGIS2:sc_L21_51_G","DataSourceGIS2:sc_L21_51_S"],u=function(e,a,r,n,o){var l=r*c,d=l+c,p=new SuperMap.GetFeaturesByBoundsParameters({datasetNames:[e],bounds:a,returnContent:!0,fromIndex:l,toIndex:d}),f=new SuperMap.GetFeaturesByBoundsService(i);f.processAsync(p,(function(i){if(i.result&&i.result.features){var l=L.geoJSON(i.result.features,{style:{color:o,weight:5},onEachFeature:function(e,t){t.on("click",(function(){console.log(e,"1-----1");var a=e.properties,r=a.name||a.名称||"未命名线路",n=Object.entries(a).map((function(e){var t=Object(s["a"])(e,2),a=t[0],r=t[1];return"<b>".concat(a,":</b> ").concat(r)})).join("<br>");t.bindPopup("<h4>".concat(r,"</h4>").concat(n)).openPopup()}))}});t.linesLayer.addLayer(l),console.log(i.result,c,"1---1"),i.result.featureCount===c&&u(e,a,r+1,n,o)}}))};o.forEach((function(e,t){u(e,r,0,[],n[t%3])}))},loadLinesByBounds:function(e){this.clearBoundsFeatures();var t=this,a=this.map;t.loading=!0;var r=this.polygonToGeoJSON(this.boundsToGeometry(a.getBounds())),n=L.supermap.Util.transform(r,L.CRS.EPSG4326,L.CRS.EPSG3857),s=new L.supermap.QueryByGeometryParameters({queryParams:{name:"China_Province_pl@China"},featureCount:1e6,geometry:n,spatialQueryMode:SuperMap.SpatialQueryMode.INTERSECT}),o=new L.supermap.QueryService("http://10.23.17.229:8090/iserver/services/map-china400/rest/maps/China");o.queryByGeometry(s,(function(e){t.loading=!1;var r=L.supermap.Util.transform(e.result.recordsets[0].features,L.CRS.EPSG3857,L.CRS.EPSG4326);t.resultBoundsLayer=L.geoJSON(r).addTo(a)}))},refreshDataView:function(){this.getDistrictDisaster(),this.getDisasterType(),this.getRectificationProgress()},getDistrictDisaster:function(){return Object(n["a"])(Object(r["a"])().mark((function e(){return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},getDisasterType:function(){var e=this;return Object(n["a"])(Object(r["a"])().mark((function t(){var a,n,s,o,c,l,d,p,f,y,h;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=function(e,t){var a=new L.supermap.GetFeaturesBySQLParameters({queryParameter:{name:e,attributeFilter:t},datasetNames:["allpoint-2:all_User"]});return a},n="灾害类型 = '崩塌'",t.next=4,e.queryDisasterDataset(i,a(u,n));case 4:return s=t.sent,e.disasterTypeModel.bt=s.result.totalCount||0,o="灾害类型 = '沉陷塌陷'",t.next=9,e.queryDisasterDataset(i,a(u,o));case 9:return c=t.sent,e.disasterTypeModel.tx=c.result.totalCount||0,l="灾害类型 = '滑坡'",t.next=14,e.queryDisasterDataset(i,a(u,l));case 14:return d=t.sent,e.disasterTypeModel.hp=d.result.totalCount||0,p="灾害类型 = '泥石流'",t.next=19,e.queryDisasterDataset(i,a(u,p));case 19:return f=t.sent,e.disasterTypeModel.nsl=f.result.totalCount||0,y="灾害类型 = '水毁'",t.next=24,e.queryDisasterDataset(i,a(u,y));case 24:h=t.sent,e.disasterTypeModel.sh=h.result.totalCount||0;case 26:case"end":return t.stop()}}),t)})))()},getRectificationProgress:function(){var e=this;return Object(n["a"])(Object(r["a"])().mark((function t(){var a,n,s,o,c,l,d;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=function(e,t){var a=new L.supermap.GetFeaturesBySQLParameters({queryParameter:{name:e,attributeFilter:t},datasetNames:["allpoint-2:all_User"]});return a},n="treatment_situation = '已处治修复' or treatment_situation = '未处治修复' or treatment_situation = '正在处治修复'",t.next=4,e.queryDisasterDataset(i,a(u,n));case 4:return s=t.sent,s.result&&(e.rectificationProgressModel.total=s.result.totalCount||0),o="treatment_situation = '已处治修复'",t.next=9,e.queryDisasterDataset(i,a(u,o));case 9:return c=t.sent,c.result&&(e.rectificationProgressModel.already=c.result.totalCount||0),l="treatment_situation = '正在处治修复' or treatment_situation = '未处治修复'",t.next=14,e.queryDisasterDataset(i,a(u,l));case 14:d=t.sent,d.result&&(e.rectificationProgressModel.deal=d.result.totalCount||0);case 16:case"end":return t.stop()}}),t)})))()},queryDisasterDataset:function(e,t){return new Promise((function(a,r){new L.supermap.FeatureService(e).getFeaturesBySQL(t).then((function(e){a(e),debubgger})).catch((function(e){r(e)}))}))}}}}}]);